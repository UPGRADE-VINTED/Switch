<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Configurateur Switch + JoyCon + SD</title>
  <style>
    body {
      font-family: 'Courier New', Courier, monospace;
      background: #f5f5f5;
      margin: 10px;
      color: #222;
    }
    h2, h3 {
      color: #2c3e50;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }
    select, label, button {
      font-size: 16px;
    }
    select {
      padding: 6px 8px;
      margin-bottom: 10px;
      width: 100%;
      box-sizing: border-box;
    }
    .joycon-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .joycon-row.disabled {
      opacity: 0.5;
      pointer-events: none;
    }
    .joycon-color {
      display: inline-block;
      width: 20px;
      height: 20px;
      border-radius: 4px;
      margin-right: 6px;
      border: 1px solid #aaa;
      vertical-align: middle;
    }
    .joycon-rouge_bleu { background: linear-gradient(45deg, #d32f2f, #1976d2); }
    .joycon-vert_rose { background: linear-gradient(45deg, #388e3c, #e91e63); }
    .joycon-gris { background: #999; }
    .joycon-jaune { background: #fbc02d; }
    .joycon-violet { background: #8e24aa; }

    .qty-buttons {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .qty-buttons button {
      background: #3498db;
      border: none;
      color: white;
      font-weight: bold;
      width: 30px;
      height: 30px;
      border-radius: 4px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.2s ease;
    }
    .qty-buttons button:hover:not(:disabled) {
      background: #2980b9;
    }
    .qty-buttons button:disabled {
      background: #bbb;
      cursor: not-allowed;
    }
    .qty-display {
      min-width: 20px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
    }

    .accessoires label {
      display: block;
      margin-bottom: 6px;
      font-weight: normal;
      cursor: pointer;
    }

    .preview {
      margin-top: 20px;
      border-top: 2px solid #ddd;
      padding-top: 15px;
    }

    #images img {
      width: 60px;
      height: auto;
      margin-right: 8px;
      border-radius: 6px;
      box-shadow: 0 0 5px rgba(0,0,0,0.15);
      vertical-align: middle;
    }

    .total {
      font-weight: bold;
      font-size: 20px;
      margin-top: 12px;
      text-align: right;
      color: #e74c3c;
    }

    #summary {
      white-space: pre;
      background: #222;
      color: #eee;
      padding: 15px;
      font-family: 'Courier New', Courier, monospace;
      border-radius: 6px;
      margin-top: 20px;
      line-height: 1.4em;
      font-size: 16px;
    }

    /* Responsive */
    @media(max-width: 600px) {
      .joycon-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }
      .qty-buttons {
        gap: 10px;
      }
      #images img {
        width: 48px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>ðŸŽ® Configurateur Switch + JoyCon + Carte SD</h2>

    <label for="switchSelect">Choisir la console Switch :</label>
    <select id="switchSelect" onchange="updateConfig()">
      <option value="Switch V2|140|switch_v2_sd">Switch V2 (manque SD) + puce - 140â‚¬</option>
      <option value="Switch V2 + SD 128Go|170|switch_v2_ok">Switch V2 + SD 128Go - 170â‚¬</option>
      <option value="Switch V1 rayÃ©e|90|switch_v1_rayure">Switch V1 rayÃ©e - 90â‚¬</option>
      <option value="Switch V1 OK|110|switch_v1_ok">Switch V1 OK - 110â‚¬</option>
    </select>

    <h3>ðŸŽ® Choisir les JoyCon (prix par paire)</h3>
    <div id="joyconOptions">
      <div class="joycon-row" id="row_joycon_rouge_bleu">
        <div>
          <span class="joycon-color joycon-rouge_bleu"></span><span class="joycon-color joycon-rouge_bleu"></span>
          Joy-Con Rouge/Bleu (3 en stock)
        </div>
        <div class="qty-buttons">
          <button aria-label="Enlever Joy-Con Rouge/Bleu" onclick="updateQty('joycon_rouge_bleu', -1)">âˆ’</button>
          <span id="joycon_rouge_bleu_qty" class="qty-display">0</span>
          <button aria-label="Ajouter Joy-Con Rouge/Bleu" onclick="updateQty('joycon_rouge_bleu', 1)">+</button>
        </div>
      </div>

      <div class="joycon-row" id="row_joycon_vert_rose">
        <div>
          <span class="joycon-color joycon-vert_rose"></span><span class="joycon-color joycon-vert_rose"></span>
          Joy-Con Vert/Rose (2 en stock)
        </div>
        <div class="qty-buttons">
          <button aria-label="Enlever Joy-Con Vert/Rose" onclick="updateQty('joycon_vert_rose', -1)">âˆ’</button>
          <span id="joycon_vert_rose_qty" class="qty-display">0</span>
          <button aria-label="Ajouter Joy-Con Vert/Rose" onclick="updateQty('joycon_vert_rose', 1)">+</button>
        </div>
      </div>

      <div class="joycon-row disabled" id="row_joycon_gris">
        <div>
          <span class="joycon-color joycon-gris"></span><span class="joycon-color joycon-gris"></span>
          Joy-Con Gris (0 en stock)
        </div>
        <div class="qty-buttons">
          <button disabled>âˆ’</button>
          <span id="joycon_gris_qty" class="qty-display">0</span>
          <button disabled>+</button>
        </div>
      </div>

      <div class="joycon-row" id="row_joycon_jaune">
        <div>
          <span class="joycon-color joycon-jaune"></span><span class="joycon-color joycon-jaune"></span>
          Joy-Con Ã‰dition Zelda (1 en stock)
        </div>
        <div class="qty-buttons">
          <button aria-label="Enlever Joy-Con Ã‰dition Zelda" onclick="updateQty('joycon_jaune', -1)">âˆ’</button>
          <span id="joycon_jaune_qty" class="qty-display">0</span>
          <button aria-label="Ajouter Joy-Con Ã‰dition Zelda" onclick="updateQty('joycon_jaune', 1)">+</button>
        </div>
      </div>

      <div class="joycon-row" id="row_joycon_violet">
        <div>
          <span class="joycon-color joycon-violet"></span><span class="joycon-color joycon-violet"></span>
          Joy-Con Violet (1 en stock)
        </div>
        <div class="qty-buttons">
          <button aria-label="Enlever Joy-Con Violet" onclick="updateQty('joycon_violet', -1)">âˆ’</button>
          <span id="joycon_violet_qty" class="qty-display">0</span>
          <button aria-label="Ajouter Joy-Con Violet" onclick="updateQty('joycon_violet', 1)">+</button>
        </div>
      </div>
    </div>

    <h3>ðŸ’¾ Choisir la carte SD :</h3>
    <select id="sdSelect" onchange="updateConfig()">
      <option value="SD 128 Go|0|sd128">SD 128 Go (offerte)</option>
      <option value="SD 256 Go|20|sd256">SD 256 Go (20â‚¬)</option>
      <option value="SD 512 Go|40|sd512">SD 512 Go (40â‚¬)</option>
    </select>

    <h3>ðŸ”Œ Accessoires</h3>
    <div class="accessoires">
      <label><input type="checkbox" value="10" data-img="chargeur" onchange="updateConfig()"> Chargeur secteur Switch (10â‚¬)</label>
      <label><input type="checkbox" value="5" data-img="cable_hdmi" onchange="updateConfig()"> CÃ¢ble HDMI (5â‚¬)</label>
      <label><input type="checkbox" value="18" data-img="chargeur_joycon" onchange="updateConfig()"> Chargeur Joy-Con (18â‚¬)</label>
    </div>

    <br />
    <button onclick="validerCommande()" style="font-size:18px; padding:10px 20px; cursor:pointer;">âœ… Valider ma liste</button>

    <div class="preview" id="preview">
      <h3>PrÃ©visualisation</h3>
      <div id="images"></div>
      <pre class="total" id="total">Total : 0â‚¬</pre>
    </div>
  </div>

  <div id="summary"></div>

  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script>
    const stockJoycon = {
      joycon_rouge_bleu: 3,
      joycon_vert_rose: 2,
      joycon_gris: 0,
      joycon_jaune: 1,
      joycon_violet: 1,
    };

    const images = {
      switch_v2_sd: 'https://i.imgur.com/XNzqOsB.jpeg',
      switch_v2_ok: 'https://i.imgur.com/zKeTFqq.png',
      switch_v1_rayure: 'https://i.imgur.com/p5yO1kM.png',
      switch_v1_ok: 'https://i.imgur.com/p5yO1kM.png',
      sd128: 'https://i.imgur.com/ZRiCDLr.jpeg',
      sd256: 'https://i.imgur.com/ZRiCDLr.jpeg',
      sd512: 'https://i.imgur.com/a3M2P8z.png',
      chargeur: 'https://i.imgur.com/QylodKV.jpeg',
      cable_hdmi: 'https://i.imgur.com/CYJdCjc.jpeg',
      chargeur_joycon: 'https://i.imgur.com/5SzFkpJ.jpeg',
      joycon_rouge_bleu: 'https://i.imgur.com/h4i6NT2.jpeg',
      joycon_vert_rose: 'https://i.imgur.com/HnrlZdX.png',
      joycon_gris: 'https://i.imgur.com/HnrlZdX.png',
      joycon_jaune: 'https://i.imgur.com/1lwBpOt.jpeg',
      joycon_violet: 'https://i.imgur.com/edqgNwl.jpeg'
    };

    let currentCode = null;

    function updateQty(key, delta) {
      const span = document.getElementById(`${key}_qty`);
      let qty = parseInt(span.innerText);
      qty = Math.max(0, Math.min(qty + delta, stockJoycon[key]));
      span.innerText = qty;
      updateConfig();
    }

    function updateConfig() {
      const imageDiv = document.getElementById('images');
      imageDiv.innerHTML = '';
      let total = 0;

      // Switch
      const switchOption = document.getElementById('switchSelect').value.split('|');
      const switchName = switchOption[0];
      const switchPrice = parseInt(switchOption[1]);
      if (!isNaN(switchPrice)) total += switchPrice;
      addImage(switchOption[2]);

      // JoyCons : 1Ã¨re paire 40â‚¬, suivantes 30â‚¬
      let joyconIndex = 0;
      let joyconSummary = '';
      for (const key in stockJoycon) {
        if(stockJoycon[key] === 0) continue;
        const qty = parseInt(document.getElementById(`${key}_qty`).innerText);
        if (qty > 0) {
          // 1Ã¨re paire 40â‚¬, suivantes 30â‚¬ chacune
          for (let i = 0; i < qty; i++) {
            total += (joyconIndex === 0) ? 40 : 30;
            joyconIndex++;
          }
          joyconSummary += `  Joy-Con x${qty}`.padEnd(25) + ` ${key.replace('joycon_', '').replace('_','/')}  \n`;
        }
      }

      // Carte SD
      const sdOption = document.getElementById('sdSelect').value.split('|');
      const sdName = sdOption[0];
      const sdPrice = parseInt(sdOption[1]);
      if (!isNaN(sdPrice)) total += sdPrice;
      addImage(sdOption[2]);

      // Accessoires cochÃ©s
      let accessoiresSummary = '';
      document.querySelectorAll('input[type=checkbox]:checked').forEach(el => {
        const val = parseInt(el.value);
        if (!isNaN(val)) total += val;
        accessoiresSummary += `  - ${el.parentNode.textContent.trim()}\n`;
        addImage(el.getAttribute('data-img'));
      });

      document.getElementById('total').innerText = 'Total : ' + total + 'â‚¬';

      // Format rÃ©sumÃ© clair alignÃ©
      // On va afficher comme demandÃ© :  
      // - switch  x1               140 â‚¬
      //      ( modÃ¨le etc) + puce
      // - joycon x1               40 â‚¬
      //      (rouge/bleu)
      // - SD 128 Go               0â‚¬
      //                   TOTAL   x â‚¬

      let summaryText = 
`===================================
         ðŸ•¹ï¸ RÃ‰SUMÃ‰ DE COMMANDE
===================================

- ${switchName.padEnd(20)} x1   ${switchPrice.toString().padStart(4)} â‚¬
  (modÃ¨le ${switchName.toLowerCase().includes('v2') ? 'v2, manque SD' : 'v1'} + puce)
`;

      // JoyCon rÃ©sumÃ© dÃ©taillÃ©
      let totalJoycon = 0;
      joyconIndex = 0;
      for (const key in stockJoycon) {
        if(stockJoycon[key] === 0) continue;
        const qty = parseInt(document.getElementById(`${key}_qty`).innerText);
        if (qty > 0) {
          for (let i = 0; i < qty; i++) {
            totalJoycon += (joyconIndex === 0) ? 40 : 30;
            joyconIndex++;
          }
          // Nom JoyCon format propre
          let nameJC = key.replace('joycon_', '').replace('_','/');
          nameJC = nameJC.charAt(0).toUpperCase() + nameJC.slice(1);
          summaryText += `- Joy-Con ${nameJC.padEnd(15)} x${qty}  ${totalJoycon.toString().padStart(4)} â‚¬\n`;
        }
      }

      summaryText += `- ${sdName.padEnd(20)}     ${sdPrice.toString().padStart(4)} â‚¬\n`;

      // Accessoires rÃ©sumÃ©
      let totalAcc = 0;
      let accList = [];
      document.querySelectorAll('input[type=checkbox]:checked').forEach(el => {
        const val = parseInt(el.value);
        if (!isNaN(val)) totalAcc += val;
        accList.push(el.parentNode.textContent.trim());
      });
      if (accList.length) {
        summaryText += '\nAccessoires :\n';
        accList.forEach(acc => {
          summaryText += `  - ${acc}\n`;
        });
        summaryText += `  Total accessoires : ${totalAcc} â‚¬\n`;
      }

      summaryText += `\n==============================\nTotal gÃ©nÃ©ral : ${total} â‚¬\n==============================`;

      document.getElementById('summary').textContent = summaryText;
    }

    function addImage(key) {
      if (!key || !images[key]) return;
      const img = document.createElement('img');
      img.src = images[key];
      img.alt = key;
      img.loading = 'lazy';
      document.getElementById('images').appendChild(img);
    }

    function validerCommande() {
      alert("Votre liste a Ã©tÃ© validÃ©e !");
    }

    updateConfig();
  </script>
</body>
</html>
