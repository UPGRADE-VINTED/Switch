<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Commande Switch personnalisée</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: auto;
    padding: 10px;
  }
  h2 {
    margin-top: 0;
  }
  .step {
    margin-bottom: 20px;
  }
  .options-row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }
  .option {
    border: 2px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    cursor: pointer;
    width: 120px;
    text-align: center;
    user-select: none;
    position: relative;
  }
  .option.selected {
    border-color: green;
    box-shadow: 0 0 10px #3c3;
  }
  .option img {
    width: 100px;
    height: 90px;
    object-fit: contain;
    margin-bottom: 5px;
    border-radius: 4px;
  }
  .qty-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-top: 5px;
  }
  button.qty-minus, button.qty-plus {
    width: 28px;
    height: 28px;
    font-weight: bold;
    font-size: 18px;
    border: none;
    background-color: #ddd;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
  }
  button.qty-minus:disabled, button.qty-plus:disabled {
    background-color: #aaa;
    cursor: not-allowed;
  }
  #summary {
    white-space: pre-wrap;
    background: #f0f0f0;
    border: 1px solid #ddd;
    padding: 15px;
    font-family: monospace;
    font-size: 16px;
    border-radius: 8px;
  }
  #buttons {
    text-align: center;
    margin-top: 20px;
  }
  #nextBtn {
    background-color: #28a745;
    color: white;
    font-weight: bold;
    padding: 10px 25px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 18px;
  }
  #nextBtn:hover {
    background-color: #218838;
  }
  @media(max-width:480px) {
    .option {
      width: 45%;
    }
    .option img {
      width: 80px;
      height: 70px;
    }
  }
</style>
</head>
<body>

<h1>Personnalisez votre Switch</h1>

<div id="steps-container">

  <!-- Étape 1 : Choix Switch -->
  <div class="step" id="step1">
    <h2>1. Choisissez votre Switch</h2>
    <div class="options-row" id="switch-options">
      <!-- Options ajoutées via JS -->
    </div>
  </div>

  <!-- Étape 2 : Choix Carte SD -->
  <div class="step" id="step2" style="display:none;">
    <h2>2. Choisissez votre carte SD</h2>
    <div class="options-row" id="sd-options">
      <!-- Options ajoutées via JS -->
    </div>
  </div>

  <!-- Étape 3 : Choix Joy-Con -->
  <div class="step" id="step3" style="display:none;">
    <h2>3. Choisissez vos Joy-Con</h2>
    <div class="options-row" id="joycon-options">
      <!-- Options ajoutées via JS -->
    </div>
  </div>

  <!-- Étape 4 : Accessoires -->
  <div class="step" id="step4" style="display:none;">
    <h2>4. Accessoires</h2>
    <div class="options-row" id="accessories-options">
      <!-- Options ajoutées via JS -->
    </div>
  </div>

  <!-- Étape 5 : Récapitulatif -->
  <div class="step" id="step5" style="display:none;">
    <h2>5. Récapitulatif</h2>
    <div id="summary">Aucune sélection pour l'instant.</div>
  </div>

</div>

<div id="buttons">
  <button id="nextBtn">Suivant</button>
</div>

<script>
  // Données images + options
  const images = {
    switch_v2_sd: 'https://i.imgur.com/XNzqOsB.jpeg',
    switch_v2_ok: 'https://i.imgur.com/zKeTFqq.png',
    switch_v1_rayure: 'https://i.imgur.com/p5yO1kM.png',
    switch_v1_ok: 'https://i.imgur.com/p5yO1kM.png',
    switch_v1_excellent: 'https://i.imgur.com/p5yO1kM.png',
    sd128: 'https://i.imgur.com/ZRiCDLr.jpeg',
    sd256: 'https://i.imgur.com/ZRiCDLr.jpeg',
    sd512: 'https://i.imgur.com/a3M2P8z.png',
    chargeur: 'https://i.imgur.com/QylodKV.jpeg',
    cable_hdmi: 'https://i.imgur.com/CYJdCjc.jpeg',
    chargeur_joycon: 'https://i.imgur.com/2a17uZp.jpeg',
    joycon_rouge_bleu: 'https://i.imgur.com/h4i6NT2.jpeg',
    joycon_vert_rose: 'https://i.imgur.com/HnrlZdX.png',
    joycon_gris: 'https://i.imgur.com/HnrlZdX.png',
    joycon_jaune: 'https://i.imgur.com/1lwBpOt.jpeg',
    joycon_violet: 'https://i.imgur.com/edqgNwl.jpeg'
  };

  // Options Switch (prix unitaires)
  const switchOptions = [
    {id:'switch_v2_sd', name:'Switch V2 (avec SD)', price:190, image: images.switch_v2_sd, stock: 5},
    {id:'switch_v2_ok', name:'Switch V2 (sans SD)', price:140, image: images.switch_v2_ok, stock: 3},
    {id:'switch_v1_rayure', name:'Switch V1 Rayure', price:100, image: images.switch_v1_rayure, stock: 2},
    {id:'switch_v1_ok', name:'Switch V1 OK', price:120, image: images.switch_v1_ok, stock: 4},
    {id:'switch_v1_excellent', name:'Switch V1 Excellent', price:150, image: images.switch_v1_excellent, stock: 1},
  ];

  // Options Carte SD
  const sdOptions = [
    {id:'sd128', name:'Carte SD 128 Go', price:0, image: images.sd128, stock: 10},
    {id:'sd256', name:'Carte SD 256 Go', price:30, image: images.sd256, stock: 5},
    {id:'sd512', name:'Carte SD 512 Go', price:60, image: images.sd512, stock: 2},
  ];

  // Options Joy-Con (prix par unité : 1ère paire 35€, suivantes 30€)
  const joyconOptions = [
    {id:'joycon_rouge_bleu', name:'Joy-Con Rouge/Bleu', priceFirstPair:35, priceNext:30, image: images.joycon_rouge_bleu, stock: 10},
    {id:'joycon_vert_rose', name:'Joy-Con Vert/Rose', priceFirstPair:35, priceNext:30, image: images.joycon_vert_rose, stock: 7},
    {id:'joycon_gris', name:'Joy-Con Gris', priceFirstPair:35, priceNext:30, image: images.joycon_gris, stock: 8},
    {id:'joycon_jaune', name:'Joy-Con Jaune', priceFirstPair:35, priceNext:30, image: images.joycon_jaune, stock: 4},
    {id:'joycon_violet', name:'Joy-Con Violet', priceFirstPair:35, priceNext:30, image: images.joycon_violet, stock: 3}
  ];

  // Options Accessoires
  const accessoriesOptionsData = [
    {id:'chargeur', name:'Chargeur USB-C', price:20, image: images.chargeur, stock: 10},
    {id:'cable_hdmi', name:'Câble HDMI', price:5, image: images.cable_hdmi, stock: 10},
    {id:'chargeur_joycon', name:'Chargeur Joy-Con', price:25, image: images.chargeur_joycon, stock: 5},
  ];

  // Variables globales
  let currentStep = 1;
  let chosenSwitch = null;
  let chosenSD = null;
  let joyconSelections = {}; // id -> qty
  let accessoriesSelections = {}; // id -> qty

  // Récupération éléments DOM
  const step1 = document.getElementById('step1');
  const step2 = document.getElementById('step2');
  const step3 = document.getElementById('step3');
  const step4 = document.getElementById('step4');
  const step5 = document.getElementById('step5');
  const nextBtn = document.getElementById('nextBtn');
  const summaryDiv = document.getElementById('summary');

  const switchContainer = document.getElementById('switch-options');
  const sdContainer = document.getElementById('sd-options');
  const joyconContainer = document.getElementById('joycon-options');
  const accessoriesContainer = document.getElementById('accessories-options');

  // Création des options HTML
  function createOptionHTML(option, selectable=true, isQty=false){
    const div = document.createElement('div');
    div.className = 'option';
    div.dataset.id = option.id;

    // Image
    const img = document.createElement('img');
    img.src = option.image;
    img.alt = option.name;
    div.appendChild(img);

    // Nom
    const nameP = document.createElement('p');
    nameP.textContent = option.name;
    div.appendChild(nameP);

    // Prix
    const priceP = document.createElement('p');
    if(isQty){
      priceP.textContent = `Prix unitaire : ${option.price.toFixed(2)} €`;
    } else if(option.price === 0){
      priceP.textContent = 'Gratuit';
    } else {
      priceP.textContent = `${option.price.toFixed(2)} €`;
    }
    div.appendChild(priceP);

    // Stock
    const stockP = document.createElement('p');
    stockP.style.fontWeight = 'bold';
    stockP.textContent = `Stock : ${option.stock}`;
    div.appendChild(stockP);

    // Pour joycon/accessoires avec quantité
    if(isQty){
      const qtyControls = document.createElement('div');
      qtyControls.className = 'qty-controls';

      const minusBtn = document.createElement('button');
      minusBtn.className = 'qty-minus';
      minusBtn.textContent = '-';

      const qtySpan = document.createElement('span');
      qtySpan.textContent = '0';
      qtySpan.style.minWidth = '20px';
      qtySpan.style.display = 'inline-block';
      qtySpan.style.textAlign = 'center';

      const plusBtn = document.createElement('button');
      plusBtn.className = 'qty-plus';
      plusBtn.textContent = '+';

      qtyControls.appendChild(minusBtn);
      qtyControls.appendChild(qtySpan);
      qtyControls.appendChild(plusBtn);
      div.appendChild(qtyControls);

      // Désactivation si stock 0
      if(option.stock === 0){
        plusBtn.disabled = true;
        minusBtn.disabled = true;
        div.style.opacity = '0.6';
        div.style.cursor = 'not-allowed';
      }

      // Événements boutons
      plusBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        let currentQty = parseInt(qtySpan.textContent);
        if(currentQty < option.stock){
          currentQty++;
          qtySpan.textContent = currentQty;
          div.dataset.qty = currentQty;
          div.classList.toggle('selected', currentQty > 0);
          if(currentQty === option.stock) plusBtn.disabled = true;
          if(currentQty > 0) minusBtn.disabled = false;
          updateSummary();
        }
      });

      minusBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        let currentQty = parseInt(qtySpan.textContent);
        if(currentQty > 0){
          currentQty--;
          qtySpan.textContent = currentQty;
          div.dataset.qty = currentQty;
          div.classList.toggle('selected', currentQty > 0);
          if(currentQty < option.stock) plusBtn.disabled = false;
          if(currentQty === 0) minusBtn.disabled = true;
          updateSummary();
        }
      });

      // Initial disable minus
      minusBtn.disabled = true;
      div.dataset.qty = '0';
    }

    if(selectable){
      div.addEventListener('click', () => {
        if(option.stock === 0) return;
        // Pour sélections simple (switch, sd) : on désélectionne les autres
        if(!isQty){
          const siblings = div.parentNode.querySelectorAll('.option');
          siblings.forEach(sib => sib.classList.remove('selected'));
          div.classList.add('selected');

          // Mémoriser la sélection
          if(div.parentNode === switchContainer){
            chosenSwitch = option;
          } else if(div.parentNode === sdContainer){
            chosenSD = option;
          }

          updateSummary();
        }
      });
    }

    return div;
  }

  // Initialisation des options
  function initOptions(){
    // Switch
    switchOptions.forEach(opt => {
      const div = createOptionHTML(opt);
      switchContainer.appendChild(div);
    });
    // Carte SD
    sdOptions.forEach(opt => {
      const div = createOptionHTML(opt);
      sdContainer.appendChild(div);
    });
    // Joy-Con (quantité)
    joyconOptions.forEach(opt => {
      const div = createOptionHTML(opt, true, true);
      joyconContainer.appendChild(div);
    });
    // Accessoires (quantité)
    accessoriesOptionsData.forEach(opt => {
      const div = createOptionHTML(opt, true, true);
      accessoriesContainer.appendChild(div);
    });
  }

  // Calcul prix Joy-Con selon quantité
  function calcJoyconPrice(qty, priceFirstPair, priceNext){
    if(qty <= 2) return (qty === 2) ? priceFirstPair : (qty === 1 ? priceFirstPair / 2 : 0);
    return priceFirstPair + (qty - 2) * priceNext;
  }

  // Mise à jour résumé
  function updateSummary(){
    let text = `Switch choisi : ${chosenSwitch ? chosenSwitch.name + ' (' + chosenSwitch.price.toFixed(2) + ' €)' : 'Aucun'}\n`;
    text += `Carte SD choisie : ${chosenSD ? chosenSD.name + ' (' + chosenSD.price.toFixed(2) + ' €)' : 'Aucune'}\n\n`;

    // Joy-Con sélectionnés
    text += 'Joy-Con sélectionnés :\n';
    joyconSelections = [];
    joyconContainer.querySelectorAll('.option').forEach(optDiv => {
      const id = optDiv.dataset.id;
      const qty = parseInt(optDiv.dataset.qty) || 0;
      if(qty > 0){
        const opt = joyconOptions.find(o => o.id === id);
        if(opt){
          const price = calcJoyconPrice(qty, opt.priceFirstPair, opt.priceNext);
          text += ` - ${opt.name} x${qty} = ${price.toFixed(2)} €\n`;
          joyconSelections.push({id, qty, price});
        }
      }
    });

    // Accessoires sélectionnés
    text += '\nAccessoires sélectionnés :\n';
    accessoriesSelections = [];
    accessoriesContainer.querySelectorAll('.option').forEach(optDiv => {
      const id = optDiv.dataset.id;
      const qty = parseInt(optDiv.dataset.qty) || 0;
      if(qty > 0){
        const opt = accessoriesOptionsData.find(o => o.id === id);
        if(opt){
          const price = qty * opt.price;
          text += ` - ${opt.name} x${qty} = ${price.toFixed(2)} €\n`;
          accessoriesSelections.push({id, qty, price});
        }
      }
    });

    // Calcul total
    const joyconTotal = joyconSelections.reduce((acc, cur) => acc + cur.price, 0);
    const accessoriesTotal = accessoriesSelections.reduce((acc, cur) => acc + cur.price, 0);
    const total = (chosenSwitch ? chosenSwitch.price : 0) + (chosenSD ? chosenSD.price : 0) + joyconTotal + accessoriesTotal;

    text += `\nPrix total : ${total.toFixed(2)} €`;

    summaryDiv.textContent = text;
  }

  // Gestion étapes
  function showStep(stepNum){
    [step1, step2, step3, step4, step5].forEach((el, idx) => {
      el.style.display = (idx + 1) === stepNum ? 'block' : 'none';
    });
    if(stepNum === 5){
      updateSummary();
      nextBtn.textContent = 'Terminer';
    } else {
      nextBtn.textContent = 'Suivant';
    }
  }

  // Validation simple à chaque étape
  function validateStep(stepNum){
    switch(stepNum){
      case 1:
        if(!chosenSwitch){
          alert('Veuillez choisir un Switch pour continuer.');
          return false;
        }
        break;
      case 2:
        if(!chosenSD){
          alert('Veuillez choisir une carte SD pour continuer.');
          return false;
        }
        break;
      // Pour joycon et accessoires, aucune sélection obligatoire
    }
    return true;
  }

  // Événement bouton suivant
  nextBtn.addEventListener('click', () => {
    if(!validateStep(currentStep)) return;

    if(currentStep < 5){
      currentStep++;
      showStep(currentStep);
    } else {
      alert('Merci pour votre commande !');
      // Ici vous pouvez envoyer les données ou réinitialiser
      location.reload();
    }
  });

  // Initialisation
  initOptions();
  showStep(1);
  updateSummary();

</script>

</body>
</html>
