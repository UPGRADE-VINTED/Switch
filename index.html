<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Commande Switch personnalisée</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: auto;
    padding: 10px;
  }
  h2 {
    margin-top: 0;
  }
  .step {
    margin-bottom: 20px;
  }
  .options-row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }
  .option {
    border: 2px solid #ccc;
    border-radius: 8px;
    padding: 10px;
    cursor: pointer;
    width: 120px;
    text-align: center;
    user-select: none;
    position: relative;
  }
  .option.selected {
    border-color: green;
    box-shadow: 0 0 10px #3c3;
  }
  .option img {
    width: 100px;
    height: 90px;
    object-fit: contain;
    margin-bottom: 5px;
    border-radius: 4px;
  }
  .qty-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-top: 5px;
  }
  button.qty-minus, button.qty-plus {
    width: 28px;
    height: 28px;
    font-weight: bold;
    font-size: 18px;
    border: none;
    background-color: #ddd;
    border-radius: 4px;
    cursor: pointer;
    user-select: none;
  }
  button.qty-minus:disabled, button.qty-plus:disabled {
    background-color: #aaa;
    cursor: not-allowed;
  }
  #summary {
    white-space: pre-wrap;
    background: #f0f0f0;
    border: 1px solid #ddd;
    padding: 15px;
    font-family: monospace;
    font-size: 16px;
    border-radius: 8px;
  }
  #buttons {
    text-align: center;
    margin-top: 20px;
  }
  #nextBtn {
    background-color: #28a745;
    color: white;
    font-weight: bold;
    padding: 10px 25px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 18px;
  }
  #nextBtn:hover {
    background-color: #218838;
  }
  @media(max-width:480px) {
    .option {
      width: 45%;
    }
    .option img {
      width: 80px;
      height: 70px;
    }
  }
</style>
</head>
<body>

<h1>Personnalisez votre Switch</h1>

<div id="steps-container">

  <!-- Étape 1 : Choix Switch -->
  <div class="step" id="step1">
    <h2>1. Choisissez votre Switch</h2>
    <div class="options-row" id="switch-options">
      <!-- Options ajoutées via JS -->
    </div>
  </div>

  <!-- Étape 2 : Choix Carte SD -->
  <div class="step" id="step2" style="display:none;">
    <h2>2. Choisissez votre carte SD</h2>
    <div class="options-row" id="sd-options">
      <!-- Options ajoutées via JS -->
    </div>
  </div>

  <!-- Étape 3 : Choix Joy-Con -->
  <div class="step" id="step3" style="display:none;">
    <h2>3. Choisissez vos Joy-Con</h2>
    <div class="options-row" id="joycon-options">
      <!-- Options ajoutées via JS -->
    </div>
  </div>

  <!-- Étape 4 : Accessoires -->
  <div class="step" id="step4" style="display:none;">
    <h2>4. Accessoires</h2>
    <div class="options-row" id="accessories-options">
      <!-- Options ajoutées via JS -->
    </div>
  </div>

  <!-- Étape 5 : Récapitulatif -->
  <div class="step" id="step5" style="display:none;">
    <h2>5. Récapitulatif</h2>
    <div id="summary">Aucune sélection pour l'instant.</div>
  </div>

</div>

<div id="buttons">
  <button id="nextBtn">Suivant</button>
</div>

<script>
  // Données images + options
  const images = {
    switch_v2_sd: 'https://i.imgur.com/XNzqOsB.jpeg',
    switch_v2_ok: 'https://i.imgur.com/zKeTFqq.png',
    switch_v1_rayure: 'https://i.imgur.com/p5yO1kM.png',
    switch_v1_ok: 'https://i.imgur.com/p5yO1kM.png',
    switch_v1_excellent: 'https://i.imgur.com/p5yO1kM.png',
    sd128: 'https://i.imgur.com/ZRiCDLr.jpeg',
    sd256: 'https://i.imgur.com/ZRiCDLr.jpeg',
    sd512: 'https://i.imgur.com/a3M2P8z.png',
    chargeur: 'https://i.imgur.com/QylodKV.jpeg',
    cable_hdmi: 'https://i.imgur.com/CYJdCjc.jpeg',
    chargeur_joycon: 'https://i.imgur.com/2a17uZp.jpeg',
    joycon_rouge_bleu: 'https://i.imgur.com/h4i6NT2.jpeg',
    joycon_vert_rose: 'https://i.imgur.com/HnrlZdX.png',
    joycon_gris: 'https://i.imgur.com/HnrlZdX.png',
    joycon_jaune: 'https://i.imgur.com/1lwBpOt.jpeg',
    joycon_violet: 'https://i.imgur.com/edqgNwl.jpeg'
  };

  // Options Switch (prix unitaires)
  const switchOptions = [
    {id:'switch_v2_sd', name:'Switch V2 (avec SD)', price:190, image: images.switch_v2_sd, stock: 5},
    {id:'switch_v2_ok', name:'Switch V2 (sans SD)', price:140, image: images.switch_v2_ok, stock: 3},
    {id:'switch_v1_rayure', name:'Switch V1 Rayure', price:100, image: images.switch_v1_rayure, stock: 2},
    {id:'switch_v1_ok', name:'Switch V1 OK', price:120, image: images.switch_v1_ok, stock: 4},
    {id:'switch_v1_excellent', name:'Switch V1 Excellent', price:150, image: images.switch_v1_excellent, stock: 1}
  ];

  // Options Carte SD
  const sdOptions = [
    {id:'sd128', name:'Carte SD 128 Go', price:0, image: images.sd128, stock: 10},
    {id:'sd256', name:'Carte SD 256 Go', price:30, image: images.sd256, stock: 5},
    {id:'sd512', name:'Carte SD 512 Go', price:60, image: images.sd512, stock: 2},
  ];

  // Options Joy-Con (prix par unité : 1ère paire 35€, suivantes 30€)
  const joyconOptions = [
    {id:'joycon_rouge_bleu', name:'Joy-Con Rouge/Bleu', priceFirstPair:35, priceNext:30, image: images.joycon_rouge_bleu, stock: 10},
    {id:'joycon_vert_rose', name:'Joy-Con Vert/Rose', priceFirstPair:35, priceNext:30, image: images.joycon_vert_rose, stock: 7},
    {id:'joycon_gris', name:'Joy-Con Gris', priceFirstPair:35, priceNext:30, image: images.joycon_gris, stock: 8},
    {id:'joycon_jaune', name:'Joy-Con Jaune', priceFirstPair:35, priceNext:30, image: images.joycon_jaune, stock: 4},
    {id:'joycon_violet', name:'Joy-Con Violet', priceFirstPair:35, priceNext:30, image: images.joycon_violet, stock: 3}
  ];

  // Options Accessoires
  const accessoriesOptionsData = [
    {id:'chargeur', name:'Chargeur USB-C', price:20, image: images.chargeur, stock: 10},
    {id:'cable_hdmi', name:'Câble HDMI', price:5, image: images.cable_hdmi, stock: 10},
    {id:'chargeur_joycon', name:'Chargeur Joy-Con', price:25, image: images.chargeur_joycon, stock: 5},
  ];

  // Variables globales
  let currentStep = 1;
  const steps = [];
  let chosenSwitch = null;
  let chosenSD = null;
  let joyConSelections = [];
  let accessoriesSelections = [];

  // Références DOM
  const switchContainer = document.getElementById('switch-options');
  const sdContainer = document.getElementById('sd-options');
  const joyconContainer = document.getElementById('joycon-options');
  const accessoriesContainer = document.getElementById('accessories-options');
  const summaryDiv = document.getElementById('summary');
  const nextBtn = document.getElementById('nextBtn');

  // Fonction affichage des options clicables (sans quantités)
  function createSelectableOptions(container, options, singleSelection = true){
    container.innerHTML = '';
    options.forEach(opt => {
      const div = document.createElement('div');
      div.classList.add('option');
      div.dataset.id = opt.id;
      div.dataset.stock = opt.stock;
      div.innerHTML = `
        <img src="${opt.image}" alt="${opt.name}" />
        <div><strong>${opt.name}</strong></div>
        <div>${opt.price} €</div>
      `;
      div.addEventListener('click', () => {
        if(singleSelection){
          // Deselect all others
          container.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
          div.classList.add('selected');
        } else {
          // Toggle selected state
          div.classList.toggle('selected');
        }
      });
      container.appendChild(div);
    });
  }

  // Fonction création options avec quantités pour JoyCon et accessoires
  function createOptionsWithQty(container, options){
    container.innerHTML = '';
    options.forEach(opt => {
      const div = document.createElement('div');
      div.classList.add('option');
      div.dataset.id = opt.id;
      div.dataset.stock = opt.stock;
      div.dataset.qty = 0;
      div.innerHTML = `
        <img src="${opt.image}" alt="${opt.name}" />
        <div><strong>${opt.name}</strong></div>
        <div>${opt.priceFirstPair !== undefined ? '35€ 1ère paire, puis 30€' : opt.price + ' €'}</div>
        <div class="qty-controls">
          <button class="qty-minus" disabled>-</button>
          <span class="qty">0</span>
          <button class="qty-plus">+</button>
        </div>
      `;
      const btnMinus = div.querySelector('.qty-minus');
      const btnPlus = div.querySelector('.qty-plus');
      const qtySpan = div.querySelector('.qty');

      btnPlus.addEventListener('click', () => {
        let currentQty = parseInt(div.dataset.qty);
        if(currentQty < opt.stock){
          currentQty++;
          div.dataset.qty = currentQty;
          qtySpan.textContent = currentQty;
          btnMinus.disabled = false;
          if(currentQty >= opt.stock){
            btnPlus.disabled = true;
          }
          // Surligner si qty > 0
          if(currentQty > 0) div.classList.add('selected');
        }
      });
      btnMinus.addEventListener('click', () => {
        let currentQty = parseInt(div.dataset.qty);
        if(currentQty > 0){
          currentQty--;
          div.dataset.qty = currentQty;
          qtySpan.textContent = currentQty;
          btnPlus.disabled = false;
          if(currentQty === 0){
            btnMinus.disabled = true;
            div.classList.remove('selected');
          }
        }
      });

      container.appendChild(div);
    });
  }

  // Fonction calcul prix JoyCon selon règles
  // Première paire : 35€; chaque JoyCon supplémentaire 30€
  function calcJoyconPrice(quantity, priceFirstPair, priceNext){
    if(quantity === 0) return 0;
    if(quantity <= 2) return priceFirstPair;
    // 2 premiers = priceFirstPair, le reste à priceNext * (quantity - 2)
    return priceFirstPair + priceNext * (quantity - 2);
  }

  // Affichage étape selon currentStep
  function showStep(step){
    for(let i=1; i<=5; i++){
      document.getElementById('step' + i).style.display = (i === step) ? 'block' : 'none';
    }
    // Changer texte bouton
    if(step === 5){
      nextBtn.textContent = 'Recommencer';
    } else {
      nextBtn.textContent = 'Suivant';
    }
  }

  // Initialiser les options
  createSelectableOptions(switchContainer, switchOptions, true);
  createSelectableOptions(sdContainer, sdOptions, true);
  createOptionsWithQty(joyconContainer, joyconOptions);
  createOptionsWithQty(accessoriesContainer, accessoriesOptionsData);

  // Événement bouton Suivant
  nextBtn.addEventListener('click', () => {
    if(currentStep === 1){
      // Choix Switch (obligatoire)
      const selected = switchContainer.querySelector('.option.selected');
      if(!selected){
        alert('Veuillez choisir un Switch');
        return;
      }
      const id = selected.dataset.id;
      chosenSwitch = switchOptions.find(o => o.id === id);
      currentStep++;
      showStep(currentStep);
    }
    else if(currentStep === 2){
      // Choix SD (obligatoire)
      const selected = sdContainer.querySelector('.option.selected');
      if(!selected){
        alert('Veuillez choisir une carte SD');
        return;
      }
      const id = selected.dataset.id;
      chosenSD = sdOptions.find(o => o.id === id);
      currentStep++;
      showStep(currentStep);
    }
    else if(currentStep === 3){
      // Joy-Con avec quantités
      joyConSelections = [];
      const selectedJoycons = joyconContainer.querySelectorAll('.option.selected');
      let totalJoyconQty = 0;

      for(const optDiv of selectedJoycons){
        const qty = parseInt(optDiv.dataset.qty, 10);
        if(qty > 0){
          const id = optDiv.dataset.id;
          const opt = joyconOptions.find(o => o.id === id);
          if(opt && qty <= opt.stock){
            joyConSelections.push({option: opt, quantity: qty});
            totalJoyconQty += qty;
          } else {
            alert(`Joy-Con ${opt.name} indisponible en stock.`);
            return;
          }
        }
      }
      // Pas obligatoire de choisir Joy-Con, on peut passer même si vide
      currentStep++;
      showStep(currentStep);
    }
    else if(currentStep === 4){
      // Accessoires avec quantités
      accessoriesSelections = [];
      const selectedAccs = accessoriesContainer.querySelectorAll('.option.selected');
      for(const optDiv of selectedAccs){
        const qty = parseInt(optDiv.dataset.qty, 10);
        if(qty > 0){
          const id = optDiv.dataset.id;
          const opt = accessoriesOptionsData.find(o => o.id === id);
          if(opt && qty <= opt.stock){
            accessoriesSelections.push({option: opt, quantity: qty});
          } else {
            alert(`Accessoire ${opt.name} indisponible en stock.`);
            return;
          }
        }
      }
      currentStep++;
      showStep(currentStep);
      displaySummary();
    }
    else if(currentStep === 5){
      // Recommencer la config
      currentStep = 1;
      chosenSwitch = null;
      chosenSD = null;
      joyConSelections = [];
      accessoriesSelections = [];

      // Désélectionner tout
      [...document.querySelectorAll('.option.selected')].forEach(el => el.classList.remove('selected'));
      [...document.querySelectorAll('.qty')].forEach(span => span.textContent = '0');
      [...document.querySelectorAll('.qty-minus')].forEach(btn => btn.disabled = true);
      [...document.querySelectorAll('.qty-plus')].forEach(btn => btn.disabled = false);
      summaryDiv.textContent = 'Aucune sélection pour l\'instant.';
      showStep(currentStep);
    }
  });

  // Afficher récapitulatif
  function displaySummary(){
    let text = '';
    let totalPrice = 0;

    if(chosenSwitch){
      text += `Switch: ${chosenSwitch.name} — ${chosenSwitch.price.toFixed(2)} €\n`;
      totalPrice += chosenSwitch.price;
    }
    if(chosenSD){
      text += `Carte SD: ${chosenSD.name} — ${chosenSD.price.toFixed(2)} €\n`;
      totalPrice += chosenSD.price;
    }

    if(joyConSelections.length > 0){
      text += `Joy-Con:\n`;
      for(const sel of joyConSelections){
        const qty = sel.quantity;
        const opt = sel.option;
        const price = calcJoyconPrice(qty, opt.priceFirstPair, opt.priceNext);
        text += ` - ${opt.name} x${qty} — ${price.toFixed(2)} €\n`;
        totalPrice += price;
      }
    }

    if(accessoriesSelections.length > 0){
      text += `Accessoires:\n`;
      for(const sel of accessoriesSelections){
        const qty = sel.quantity;
        const opt = sel.option;
        const price = opt.price * qty;
        text += ` - ${opt.name} x${qty} — ${price.toFixed(2)} €\n`;
        totalPrice += price;
      }
    }

    text += `\nPrix total: ${totalPrice.toFixed(2)} €`;
    summaryDiv.textContent = text;
  }
</script>

</body>
</html>
