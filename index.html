<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Commande Switch - Résumé Ticket</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 10px;
    background: #fafafa;
  }
  h1 {
    text-align: center;
  }
  select, label {
    font-size: 1rem;
  }
  #config {
    margin-bottom: 1em;
  }
  #config > div {
    margin-bottom: 1em;
  }

  /* Boutons + / - visibles et stylés */
  .qty-buttons button {
    width: 34px;
    height: 34px;
    font-size: 1.2rem;
    font-weight: bold;
    border: 1px solid #666;
    background-color: #f9f9f9;
    border-radius: 5px;
    color: #000;
    cursor: pointer;
    margin: 0 5px;
  }
  .qty-buttons button:hover {
    background-color: #e0e0e0;
  }
  .qty-display {
    width: 28px;
    text-align: center;
    font-size: 1rem;
    font-weight: bold;
    display: inline-block;
  }

  /* Supprimer case grise indésirable (on ne crée pas dans HTML) */

  /* Résumé ticket */
  #summary {
    border: 2px dashed #444;
    background: #fff;
    padding: 10px;
    max-width: 400px;
    margin: 10px auto;
    white-space: pre-wrap;
    font-family: monospace;
    font-size: 14px;
    color: #222;
  }
  #images {
    text-align: center;
    margin: 15px 0;
  }
  #images img {
    max-height: 48px;
    margin: 5px;
  }

  /* Bouton valider */
  #btnValider {
    display: block;
    margin: 15px auto;
    padding: 12px 25px;
    font-size: 1.1rem;
    background: #2ecc71;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  #btnValider:hover {
    background: #27ae60;
  }

  /* Responsive mobile */
  @media (max-width: 480px) {
    #summary {
      max-width: 95vw;
      font-size: 13px;
    }
    .qty-buttons button {
      width: 28px;
      height: 28px;
      font-size: 1rem;
      margin: 0 3px;
    }
    .qty-display {
      width: 24px;
      font-size: 0.9rem;
    }
  }
</style>
</head>
<body>

<h1>Personnalisez votre commande Switch</h1>

<div id="config">

  <!-- Console -->
  <div>
    <label for="switchSelect">Console :</label>
    <select id="switchSelect" onchange="updateConfig()">
      <option value="V2 - état impeccable|190|console">V2 - état impeccable — 190€</option>
      <option value="V1 - bon état|140|console">V1 - bon état — 140€</option>
    </select>
  </div>

  <!-- Carte SD -->
  <div>
    <label for="sdSelect">Carte SD :</label>
    <select id="sdSelect" onchange="updateConfig()">
      <option value="128 Go|0|sd">128 Go — 0€</option>
      <option value="256 Go|15|sd">256 Go — 15€</option>
      <option value="512 Go|35|sd">512 Go — 35€</option>
    </select>
  </div>

  <!-- Joy-Con -->
  <div>
    <label>Joy-Con :</label>
    <div id="joyconList">
      <div>
        Rouge / Bleu
        <span class="qty-buttons">
          <button onclick="changeQty('joycon_rouge_bleu', -1)">−</button>
          <span id="joycon_rouge_bleu_qty" class="qty-display">0</span>
          <button onclick="changeQty('joycon_rouge_bleu', 1)">+</button>
        </span>
        <span>35€</span>
      </div>
      <div>
        Gris
        <span class="qty-buttons">
          <button onclick="changeQty('joycon_gris', -1)">−</button>
          <span id="joycon_gris_qty" class="qty-display">0</span>
          <button onclick="changeQty('joycon_gris', 1)">+</button>
        </span>
        <span>30€</span>
      </div>
    </div>
  </div>

  <!-- Puce HWFLY -->
  <div>
    <label>
      <input type="checkbox" id="puceHWFLY" checked disabled />
      Puce HWFLY (par défaut, obligatoire)
    </label>
  </div>

</div>

<!-- Images associées -->
<div id="images"></div>

<!-- Résumé commande -->
<div id="summary">Prévisualisation...</div>

<!-- Total classique -->
<div style="text-align:center; font-weight:bold; font-size:1.2rem;" id="total">Total : 0€</div>

<button id="btnValider" onclick="validerCommande()">Valider ma liste</button>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script>
  // Images associées (exemples - remplace par tes propres liens)
  const images = {
    'console': 'https://cdn-icons-png.flaticon.com/512/642/642140.png',
    'sd': 'https://cdn-icons-png.flaticon.com/512/151/151916.png',
    'joycon_rouge_bleu': 'https://cdn-icons-png.flaticon.com/512/1006/1006555.png',
    'joycon_gris': 'https://cdn-icons-png.flaticon.com/512/1006/1006543.png',
    'puceHWFLY': 'https://cdn-icons-png.flaticon.com/512/709/709496.png'
  };

  let currentCode = '';

  // Stock joycon avec leur prix unitaire
  const stockJoycon = {
    joycon_rouge_bleu: 35,
    joycon_gris: 30
  };

  function changeQty(id, delta) {
    const span = document.getElementById(id + '_qty');
    let qty = parseInt(span.innerText);
    qty += delta;
    if (qty < 0) qty = 0;
    span.innerText = qty;
    updateConfig();
  }

  function updateConfig() {
    const imageDiv = document.getElementById('images');
    imageDiv.innerHTML = '';
    let total = 0;
    let lines = [];

    // Console
    const switchOption = document.getElementById('switchSelect').value.split('|');
    const switchName = switchOption[0];
    const switchPrice = parseInt(switchOption[1]);
    total += switchPrice;
    addImage('console');
    lines.push(`- Console x1`.padEnd(35) + `${switchPrice} €`);
    lines.push(`   (${switchName}) + puce HWFLY`);

    // Carte SD
    const sdOption = document.getElementById('sdSelect').value.split('|');
    const sdName = sdOption[0];
    const sdPrice = parseInt(sdOption[1]);
    total += sdPrice;
    addImage('sd');
    lines.push(`\n- Carte SD ${sdName} x1`.padEnd(35) + `${sdPrice} €`);

    // Joy-Con
    let joyconIndex = 0;
    for (const key in stockJoycon) {
      const qty = parseInt(document.getElementById(key + '_qty').innerText);
      if (qty > 0) {
        const unitPrice = stockJoycon[key];
        const totalPrice = unitPrice * qty;
        let joyconName = key.replace('joycon_', '').replace('_', ' ');
        // Majuscule première lettre
        joyconName = joyconName.split(' ').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        lines.push(`\n- Joy-Con x${qty}`.padEnd(35) + `${totalPrice} €`);
        lines.push(`   (${joyconName})`);
        for(let i=0; i<qty; i++){
          total += unitPrice;
          addImage(key);
          joyconIndex++;
        }
      }
    }

    // Puce HWFLY (obligatoire, cochée, pas modifiable)
    addImage('puceHWFLY');

    // Total final
    lines.push(`\n` + '-'.repeat(43));
    lines.push(`TOTAL`.padEnd(35) + `${total} €`);

    // Afficher résumé
    const summary = document.getElementById('summary');
    summary.innerHTML = `<pre>${lines.join('\n')}</pre>`;

    // Total classique en bas
    document.getElementById('total').innerText = 'Total : ' + total + '€';

    function addImage(key) {
      const img = document.createElement('img');
      img.src = images[key];
      img.alt = key;
      img.style.maxHeight = '48px';
      img.style.margin = '5px';
      imageDiv.appendChild(img);
    }
  }

  function validerCommande() {
    currentCode = 'CMD-' + Math.random().toString(36).substring(2,8).toUpperCase();
    updateConfig();

    const summaryDiv = document.getElementById('summary');

    html2canvas(summaryDiv, {
      backgroundColor: '#fff',
      scale: 2
    }).then(canvas => {
      canvas.toBlob(function(blob) {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `commande-${currentCode}.png`;
        a.click();
        URL.revokeObjectURL(a.href);
      });
    });
  }

  // Initial update
  updateConfig();
</script>

</body>
</html>
