<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Configurateur Switch</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 10px;
    background: #f7f7f7;
  }
  h2 {
    margin-bottom: 5px;
  }
  .step {
    margin-bottom: 20px;
  }
  .options {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .option {
    border: 2px solid #ccc;
    border-radius: 8px;
    padding: 5px;
    cursor: pointer;
    text-align: center;
    width: 120px;
    background: white;
    transition: border-color 0.3s;
  }
  .option.selected {
    border-color: #28a745;
    box-shadow: 0 0 10px #28a745a0;
  }
  .option img {
    max-width: 100px;
    height: auto;
    margin-bottom: 5px;
    border-radius: 6px;
  }
  .option span {
    display: block;
    font-weight: bold;
  }
  .option small {
    font-weight: normal;
    font-size: 0.85em;
    color: #555;
  }
  button {
    background: #28a745;
    color: white;
    border: none;
    padding: 12px 25px;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
  }
  button:disabled {
    background: #aaa;
    cursor: not-allowed;
  }
  #summary {
    background: white;
    padding: 15px;
    border-radius: 10px;
    font-family: 'Courier New', Courier, monospace;
    white-space: pre-wrap;
    box-shadow: 0 0 8px #ddd;
    max-width: 400px;
    margin-top: 20px;
  }
  @media(max-width: 480px) {
    .options {
      justify-content: center;
    }
    .option {
      width: 45vw;
    }
  }
</style>
</head>
<body>

<h1>Configure ta Switch</h1>

<div class="step" id="step1">
  <h2>1. Choisis ta Switch</h2>
  <div class="options" id="switch-options">
    <div class="option" data-name="Switch modèle V1" data-price="140">
      <img src="https://cdn.pixabay.com/photo/2014/04/03/10/51/video-game-309345_1280.png" alt="Switch V1"/>
      <span>Switch modèle V1</span>
      <small>(manque SD, + puce)</small>
      <br>140 €
    </div>
    <div class="option" data-name="Switch modèle V2" data-price="190">
      <img src="https://cdn.pixabay.com/photo/2017/01/31/21/25/video-game-2022164_1280.png" alt="Switch V2"/>
      <span>Switch modèle V2</span>
      <small>(état impeccable)</small>
      <br>190 €
    </div>
    <div class="option" data-name="Switch Lite" data-price="120">
      <img src="https://cdn.pixabay.com/photo/2017/01/31/21/26/video-game-2022165_1280.png" alt="Switch Lite"/>
      <span>Switch Lite</span>
      <small>(compact & portable)</small>
      <br>120 €
    </div>
    <!-- Ajoute d’autres modèles si besoin -->
  </div>
</div>

<div class="step" id="step2" style="display:none;">
  <h2>2. Choisis ta carte SD</h2>
  <div class="options" id="sd-options">
    <div class="option" data-name="Carte SD 128 Go" data-price="0">
      <img src="https://cdn.pixabay.com/photo/2017/01/11/21/26/sd-card-1971223_1280.png" alt="SD 128 Go"/>
      <span>128 Go</span>
      <small>~10 jeux</small>
      <br>0 €
    </div>
    <div class="option" data-name="Carte SD 256 Go" data-price="30">
      <img src="https://cdn.pixabay.com/photo/2014/04/03/10/50/sd-card-309338_1280.png" alt="SD 256 Go"/>
      <span>256 Go</span>
      <small>~18 jeux</small>
      <br>30 €
    </div>
  </div>
</div>

<div class="step" id="step3" style="display:none;">
  <h2>3. Choisis tes Joy-Con</h2>
  <div class="options" id="joycon-options">
    <div class="option" data-name="Joy-Con rouge/bleu" data-price="40">
      <img src="https://cdn.pixabay.com/photo/2018/11/05/13/52/game-controller-3794399_1280.png" alt="Joy-Con rouge/bleu"/>
      <span>Joy-Con rouge/bleu</span>
      <br>40 €
    </div>
    <div class="option" data-name="Joy-Con gris" data-price="35">
      <img src="https://cdn.pixabay.com/photo/2019/11/21/20/01/game-controller-4647061_1280.png" alt="Joy-Con gris"/>
      <span>Joy-Con gris</span>
      <br>35 €
    </div>
  </div>
</div>

<div class="step" id="step4" style="display:none;">
  <h2>4. Choisis tes accessoires</h2>
  <div class="options" id="accessory-options">
    <div class="option" data-name="Puce Hwfly" data-price="50">
      <img src="https://cdn.pixabay.com/photo/2018/02/24/14/00/memory-3171150_1280.png" alt="Puce Hwfly"/>
      <span>Puce Hwfly</span>
      <br>50 €
    </div>
    <div class="option" data-name="Câble HDMI" data-price="5">
      <img src="https://cdn.pixabay.com/photo/2014/04/03/10/51/hdmi-309346_1280.png" alt="Câble HDMI"/>
      <span>Câble HDMI</span>
      <br>5 €
    </div>
  </div>
</div>

<button id="next-btn" disabled>Suivant</button>

<div id="summary" style="display:none; white-space: pre-wrap; font-family: monospace;"></div>

<script>
  const steps = ['step1', 'step2', 'step3', 'step4'];
  let currentStep = 0;

  // Stocke la sélection
  let selections = {
    switch: null,
    sd: null,
    joycon: null,
    accessory: []
  };

  const nextBtn = document.getElementById('next-btn');
  const summaryDiv = document.getElementById('summary');

  function updateButton() {
    // bouton activé si on a fait un choix dans l'étape en cours
    let canContinue = false;
    if (currentStep === 3) {
      // Au dernier step on peut valider dès qu'il y a au moins un accessoire ou aucun (accessoire optionnels)
      canContinue = true;
    } else {
      const stepId = steps[currentStep];
      const options = document.querySelectorAll(`#${stepId} .option.selected`);
      canContinue = options.length > 0;
    }
    nextBtn.disabled = !canContinue;
    nextBtn.textContent = currentStep === steps.length -1 ? 'Valider ma liste' : 'Suivant';
  }

  function clearSelectionInStep(stepId) {
    document.querySelectorAll(`#${stepId} .option`).forEach(el => {
      el.classList.remove('selected');
    });
  }

  function selectOption(event) {
    const option = event.currentTarget;
    const stepId = steps[currentStep];

    if (stepId === 'step4') {
      // accessoires = multi sélection possible
      option.classList.toggle('selected');
    } else {
      // une sélection par étape (switch, sd, joycon)
      clearSelectionInStep(stepId);
      option.classList.add('selected');
    }

    // Sauvegarde sélection
    switch(stepId) {
      case 'step1':
        selections.switch = option.dataset;
        break;
      case 'step2':
        selections.sd = option.dataset;
        break;
      case 'step3':
        selections.joycon = option.dataset;
        break;
      case 'step4':
        // récupère tous les accessoires sélectionnés
        const selectedAcc = Array.from(document.querySelectorAll('#step4 .option.selected'));
        selections.accessory = selectedAcc.map(el => el.dataset);
        break;
    }
    updateButton();
  }

  function showStep(index) {
    steps.forEach((id, i) => {
      document.getElementById(id).style.display = i === index ? 'block' : 'none';
    });
    summaryDiv.style.display = 'none';
    updateButton();
  }

  function formatPrice(price) {
    return Number(price).toLocaleString('fr-FR', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 });
  }

  function generateSummaryText() {
    let lines = [];
    lines.push("✅ Résumé de commande\n");
    // Switch
    if (selections.switch) {
      lines.push(`${selections.switch.name} x1`.padEnd(30) + formatPrice(selections.switch.price));
      if(selections.switch.name.toLowerCase().includes('v1')) {
        lines.push("  (manque SD) + puce");
      }
    }
    // SD
    if (selections.sd) {
      lines.push(`${selections.sd.name}`.padEnd(30) + formatPrice(selections.sd.price));
    }
    // Joycon
    if (selections.joycon) {
      lines.push(`${selections.joycon.name} x1`.padEnd(30) + formatPrice(selections.joycon.price));
    }
    // Accessoires
    selections.accessory.forEach(acc => {
      lines.push(`${acc.name}`.padEnd(30) + formatPrice(acc.price));
    });

    const total = [selections.switch, selections.sd, selections.joycon]
      .concat(selections.accessory)
      .reduce((acc, cur) => acc + Number(cur.price), 0);

    lines.push("\n" + "TOTAL".padStart(35) + "   " + formatPrice(total));
    return lines.join("\n");
  }

  function generateImageFromSummary(text) {
    // On crée un canvas et on dessine le texte dessus
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    // canvas taille fixe (largeur/hauteur)
    canvas.width = 400;
    canvas.height = 320;

    // fond blanc
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // texte noir
    ctx.fillStyle = 'black';
    ctx.font = '16px Courier New';
    const lineHeight = 22;
    const lines = text.split('\n');
    for (let i=0; i<lines.length; i++) {
      ctx.fillText(lines[i], 10, 30 + i * lineHeight);
    }

    return canvas.toDataURL('image/png');
  }

  nextBtn.addEventListener('click', () => {
    if (currentStep < steps.length -1) {
      currentStep++;
      showStep(currentStep);
    } else {
      // Valider ma liste => télécharger image résumé
      const summaryText = generateSummaryText();
      const dataUrl = generateImageFromSummary(summaryText);

      const a = document.createElement('a');
      a.href = dataUrl;
      a.download = 'resume_commande.png';
      a.click();
    }
  });

  // initialisation
  showStep(0);

  // ajoute gestion clic sur options
  ['switch-options', 'sd-options', 'joycon-options', 'accessory-options'].forEach(id => {
    document.getElementById(id).querySelectorAll('.option').forEach(el => {
      el.addEventListener('click', selectOption);
    });
  });
</script>

</body>
</html>
