<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pack Switch modifi√©e</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 1rem;
      background: #f7f7f7;
    }
    .configurator {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .options, .preview {
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .preview {
      text-align: center;
    }
    .joycon-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .qty-buttons button {
      width: 30px;
      height: 30px;
      font-size: 1rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      background: #fff;
    }
    .ticket {
      background: #fff;
      padding: 1rem;
      font-family: monospace;
      text-align: left;
      border: 1px dashed #aaa;
      max-width: 300px;
      margin: auto;
    }
    .ticket hr {
      border: none;
      border-top: 1px dashed #ccc;
      margin: 0.5rem 0;
    }
    .ticket-line {
      display: flex;
      justify-content: space-between;
    }
    .sub-info {
      margin-left: 1rem;
      font-size: 0.9rem;
      color: #555;
    }
    @media(max-width: 600px) {
      .configurator {
        padding: 0.5rem;
      }
      .options, .preview {
        padding: 0.5rem;
      }
    }
  </style>
</head>
<body>
  <h2>Pr√©parer ma Switch modifi√©e</h2>
  <div class="configurator">
    <div class="options">
      <label>Switch
        <select id="switchSelect" onchange="updateConfig()">
          <option value="V2 manq. SD|140">V2 - manque cache SD (140‚Ç¨)</option>
          <option value="V2 impeccable|160">V2 - √©tat impeccable (160‚Ç¨)</option>
        </select>
      </label>
      <br>
      <label style="display: flex; align-items: center; margin-top: 0.5rem;">
        <input type="checkbox" checked disabled style="accent-color: green;" />
        <span style="margin-left: 8px;">Puce HWFLY (incluse)</span>
      </label>
      <br>
      <label>Carte SD
        <select id="sdSelect" onchange="updateConfig()">
          <option value="128|0">128 Go (incluse)</option>
          <option value="256|15">256 Go (+15‚Ç¨)</option>
        </select>
      </label>
      <br>
      <h4>üé® Joy-Con</h4>
      <div class="joycon-row">
        Rouge/Bleu
        <div class="qty-buttons">
          <button onclick="updateQty('rb', -1)">-</button>
          <span id="rb_qty">0</span>
          <button onclick="updateQty('rb', 1)">+</button>
        </div>
      </div>
      <div class="joycon-row">
        Vert/Rose
        <div class="qty-buttons">
          <button onclick="updateQty('vr', -1)">-</button>
          <span id="vr_qty">0</span>
          <button onclick="updateQty('vr', 1)">+</button>
        </div>
      </div>
      <br>
      <label><input type="checkbox" value="5" data-label="C√¢ble HDMI" onchange="updateConfig()"> C√¢ble HDMI (5‚Ç¨)</label><br>
      <label><input type="checkbox" value="10" data-label="Chargeur" onchange="updateConfig()"> Chargeur (10‚Ç¨)</label>
      <br><br>
      <button onclick="validerCommande()">‚úÖ Valider ma liste</button>
    </div>

    <div class="preview">
      <h4>Pr√©visualisation</h4>
      <div id="ticket" class="ticket"></div>
    </div>
  </div>

  <script>
    const stock = {
      rb: 5,
      vr: 2
    };
    const qty = { rb: 0, vr: 0 };

    function updateQty(type, delta) {
      qty[type] = Math.max(0, Math.min(stock[type], qty[type] + delta));
      document.getElementById(`${type}_qty`).innerText = qty[type];
      updateConfig();
    }

    function updateConfig() {
      const ticket = document.getElementById("ticket");
      ticket.innerHTML = '';
      let total = 0;
      let lines = [];

      // Switch
      const [model, priceSwitch] = document.getElementById('switchSelect').value.split('|');
      total += parseInt(priceSwitch);
      lines.push(`<div class='ticket-line'><span>- Switch x1</span><span>${priceSwitch}‚Ç¨</span></div>`);
      lines.push(`<div class='sub-info'>(mod√®le ${model} + puce)</div>`);

      // SD
      const [sdLabel, sdPrice] = document.getElementById('sdSelect').value.split('|');
      total += parseInt(sdPrice);
      lines.push(`<div class='ticket-line'><span>- SD ${sdLabel} Go</span><span>${sdPrice}‚Ç¨</span></div>`);

      // Joy-Cons
      let i = 0;
      for (const [type, q] of Object.entries(qty)) {
        if (q > 0) {
          for (let j = 0; j < q; j++) {
            const prix = (i === 0) ? 35 : 30;
            total += prix;
            const nom = (type === 'rb') ? 'Rouge / Bleu' : 'Vert / Rose';
            lines.push(`<div class='ticket-line'><span>- Joy-Con x1</span><span>${prix}‚Ç¨</span></div>`);
            lines.push(`<div class='sub-info'>(${nom})</div>`);
            i++;
          }
        }
      }

      // Accessoires
      document.querySelectorAll('input[type=checkbox]').forEach(cb => {
        if (cb.checked && !cb.disabled) {
          const p = parseInt(cb.value);
          total += p;
          const lbl = cb.dataset.label;
          lines.push(`<div class='ticket-line'><span>- ${lbl}</span><span>${p}‚Ç¨</span></div>`);
        }
      });

      lines.push('<hr>');
      lines.push(`<div class='ticket-line'><strong>TOTAL</strong><strong>${total}‚Ç¨</strong></div>`);

      ticket.innerHTML = lines.join('\n');
    }

    function validerCommande() {
      const code = 'CMD-' + Math.random().toString(36).substring(2, 8).toUpperCase();
      const ticketNode = document.getElementById("ticket");
      const clone = ticketNode.cloneNode(true);
      const label = document.createElement('div');
      label.style.textAlign = 'center';
      label.style.fontWeight = 'bold';
      label.style.marginBottom = '10px';
      label.innerText = `\u2705 Commande ${code}`;
      const container = document.createElement('div');
      container.appendChild(label);
      container.appendChild(clone);

      html2canvas(container).then(canvas => {
        const a = document.createElement('a');
        a.href = canvas.toDataURL();
        a.download = `ticket-${code}.png`;
        a.click();
      });
    }

    updateConfig();
  </script>
</body>
</html>
