<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Configurateur Switch</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 10px;
    background: #f7f7f7;
  }
  h2 {
    margin-bottom: 5px;
  }
  .step {
    margin-bottom: 20px;
  }
  .options {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .option {
    border: 2px solid #ccc;
    border-radius: 8px;
    padding: 5px;
    cursor: pointer;
    text-align: center;
    width: 150px;
    background: white;
    transition: border-color 0.3s;
    position: relative;
  }
  .option.selected {
    border-color: #28a745;
    box-shadow: 0 0 10px #28a745a0;
  }
  .option img {
    max-width: 150px;
    height: auto;
    margin-bottom: 5px;
    border-radius: 6px;
  }
  .option span {
    display: block;
    font-weight: bold;
  }
  .option small {
    font-weight: normal;
    font-size: 0.85em;
    color: #555;
  }
  button {
    background: #28a745;
    color: white;
    border: none;
    padding: 12px 25px;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
  }
  button:disabled {
    background: #aaa;
    cursor: not-allowed;
  }
  #summary {
    background: white;
    padding: 15px;
    border-radius: 10px;
    font-family: 'Courier New', Courier, monospace;
    white-space: pre-wrap;
    box-shadow: 0 0 8px #ddd;
    max-width: 400px;
    margin-top: 20px;
  }
  .qty-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 8px;
    margin-top: 8px;
  }
  .qty-controls button {
    width: 25px;
    height: 25px;
    font-weight: bold;
    font-size: 1.2rem;
    line-height: 1;
    padding: 0;
    background: #ddd;
    border: 1px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
  }
  .qty-controls span {
    min-width: 20px;
    text-align: center;
    font-weight: bold;
  }
  @media(max-width: 480px) {
    .options {
      justify-content: center;
    }
    .option {
      width: 90vw;
    }
    .option img {
      max-width: 90vw;
    }
  }
</style>
</head>
<body>

<h1>Configure ta Switch</h1>

<div class="step" id="step1">
  <h2>1. Choisis ta Switch</h2>
  <div class="options" id="switch-options">
    <div class="option" data-name="Switch modèle V2 avec SD" data-price="190">
      <img src="https://i.imgur.com/XNzqOsB.jpeg" alt="Switch V2 avec SD"/>
      <span>Switch V2 avec SD</span>
      <small>(état impeccable)</small>
      <br>190 €
    </div>
    <div class="option" data-name="Switch modèle V2 OK" data-price="180">
      <img src="https://i.imgur.com/zKeTFqq.png" alt="Switch V2 OK"/>
      <span>Switch V2 OK</span>
      <small>(bon état)</small>
      <br>180 €
    </div>
    <div class="option" data-name="Switch modèle V1 rayure" data-price="140">
      <img src="https://i.imgur.com/p5yO1kM.png" alt="Switch V1 rayure"/>
      <span>Switch V1 rayure</span>
      <small>(manque SD + puce)</small>
      <br>140 €
    </div>
    <div class="option" data-name="Switch modèle V1 OK" data-price="150">
      <img src="https://i.imgur.com/p5yO1kM.png" alt="Switch V1 OK"/>
      <span>Switch V1 OK</span>
      <small>(bon état)</small>
      <br>150 €
    </div>
    <div class="option" data-name="Switch modèle V1 excellent" data-price="170">
      <img src="https://i.imgur.com/p5yO1kM.png" alt="Switch V1 excellent"/>
      <span>Switch V1 excellent</span>
      <small>(comme neuf)</small>
      <br>170 €
    </div>
  </div>
</div>

<div class="step" id="step2" style="display:none;">
  <h2>2. Choisis ta carte SD</h2>
  <div class="options" id="sd-options">
    <div class="option" data-name="Carte SD 128 Go" data-price="0">
      <img src="https://i.imgur.com/ZRiCDLr.jpeg" alt="SD 128 Go"/>
      <span>128 Go</span>
      <small>~10 jeux</small>
      <br>0 €
    </div>
    <div class="option" data-name="Carte SD 256 Go" data-price="30">
      <img src="https://i.imgur.com/ZRiCDLr.jpeg" alt="SD 256 Go"/>
      <span>256 Go</span>
      <small>~18 jeux</small>
      <br>30 €
    </div>
    <div class="option" data-name="Carte SD 512 Go" data-price="60">
      <img src="https://i.imgur.com/a3M2P8z.png" alt="SD 512 Go"/>
      <span>512 Go</span>
      <small>~35 jeux</small>
      <br>60 €
    </div>
  </div>
</div>

<div class="step" id="step3" style="display:none;">
  <h2>3. Choisis tes Joy-Con</h2>
  <div class="options" id="joycon-options">
    <!-- Chaque Joy-Con avec stock initial, prix à 35€ la 1ère unité, 30€ les suivantes -->
    <div class="option" data-name="Joy-Con rouge/bleu" data-baseprice="35" data-addprice="30" data-stock="5" data-qty="0">
      <img src="https://i.imgur.com/h4i6NT2.jpeg" alt="Joy-Con rouge/bleu"/>
      <span>Joy-Con rouge/bleu</span><br>
      <small>Stock: <span class="stock-count">5</span></small><br>
      <div class="qty-controls">
        <button class="qty-minus" disabled>-</button>
        <span class="qty">0</span>
        <button class="qty-plus">+</button>
      </div>
      <small>Prix: <span class="price">0</span> €</small>
    </div>
    <div class="option" data-name="Joy-Con vert/rose" data-baseprice="35" data-addprice="30" data-stock="3" data-qty="0">
      <img src="https://i.imgur.com/HnrlZdX.png" alt="Joy-Con vert/rose"/>
      <span>Joy-Con vert/rose</span><br>
      <small>Stock: <span class="stock-count">3</span></small><br>
      <div class="qty-controls">
        <button class="qty-minus" disabled>-</button>
        <span class="qty">0</span>
        <button class="qty-plus">+</button>
      </div>
      <small>Prix: <span class="price">0</span> €</small>
    </div>
    <div class="option" data-name="Joy-Con gris" data-baseprice="35" data-addprice="30" data-stock="4" data-qty="0">
      <img src="https://i.imgur.com/HnrlZdX.png" alt="Joy-Con gris"/>
      <span>Joy-Con gris</span><br>
      <small>Stock: <span class="stock-count">4</span></small><br>
      <div class="qty-controls">
        <button class="qty-minus" disabled>-</button>
        <span class="qty">0</span>
        <button class="qty-plus">+</button>
      </div>
      <small>Prix: <span class="price">0</span> €</small>
    </div>
    <div class="option" data-name="Joy-Con jaune" data-baseprice="35" data-addprice="30" data-stock="2" data-qty="0">
      <img src="https://i.imgur.com/1lwBpOt.jpeg" alt="Joy-Con jaune"/>
      <span>Joy-Con jaune</span><br>
      <small>Stock: <span class="stock-count">2</span></small><br>
      <div class="qty-controls">
        <button class="qty-minus" disabled>-</button>
        <span class="qty">0</span>
        <button class="qty-plus">+</button>
      </div>
      <small>Prix: <span class="price">0</span> €</small>
    </div>
    <div class="option" data-name="Joy-Con violet" data-baseprice="35" data-addprice="30" data-stock="1" data-qty="0">
      <img src="https://i.imgur.com/edqgNwl.jpeg" alt="Joy-Con violet"/>
      <span>Joy-Con violet</span><br>
      <small>Stock: <span class="stock-count">1</span></small><br>
      <div class="qty-controls">
        <button class="qty-minus" disabled>-</button>
        <span class="qty">0</span>
        <button class="qty-plus">+</button>
      </div>
      <small>Prix: <span class="price">0</span> €</small>
    </div>
  </div>
</div>

<div class="step" id="step4" style="display:none;">
  <h2>4. Récapitulatif</h2>
  <div id="summary">Aucune sélection pour l'instant.</div>
</div>

<button id="nextBtn">Suivant</button>

<script>
  const nextBtn = document.getElementById('nextBtn');
  let currentStep = 1;

  const steps = {
    1: document.getElementById('step1'),
    2: document.getElementById('step2'),
    3: document.getElementById('step3'),
    4: document.getElementById('step4'),
  };

  // Variables pour stocker les choix
  let chosenSwitch = null;
  let chosenSD = null;
  let joyConSelections = []; // {name, qty, price} avec qty > 0

  // Fonctions utilitaires
  function deselectAll(container) {
    container.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
  }

  function selectOption(container, option) {
    deselectAll(container);
    option.classList.add('selected');
  }

  // Étape 1 - Switch
  const switchOptions = document.getElementById('switch-options');
  switchOptions.querySelectorAll('.option').forEach(opt => {
    opt.addEventListener('click', () => {
      selectOption(switchOptions, opt);
      chosenSwitch = {
        name: opt.dataset.name,
        price: parseFloat(opt.dataset.price)
      };
    });
  });

  // Étape 2 - SD
  const sdOptions = document.getElementById('sd-options');
  sdOptions.querySelectorAll('.option').forEach(opt => {
    opt.addEventListener('click', () => {
      selectOption(sdOptions, opt);
      chosenSD = {
        name: opt.dataset.name,
        price: parseFloat(opt.dataset.price)
      };
    });
  });

  // Étape 3 - JoyCon
  const joyConOptions = document.getElementById('joycon-options');
  // Ici, on gère le + / - avec contrôle du stock, et prix spécial
  joyConOptions.querySelectorAll('.option').forEach(opt => {
    const plusBtn = opt.querySelector('.qty-plus');
    const minusBtn = opt.querySelector('.qty-minus');
    const qtySpan = opt.querySelector('.qty');
    const stockSpan = opt.querySelector('.stock-count');
    const priceSpan = opt.querySelector('.price');

    let stock = parseInt(opt.dataset.stock);
    let qty = 0;

    function updatePriceAndQtyDisplay() {
      qtySpan.textContent = qty;
      minusBtn.disabled = qty <= 0;
      plusBtn.disabled = qty >= stock;

      // On calcule le prix total de cette option selon règles
      // Première unité = baseprice, unités suivantes = addprice
      const basePrice = parseFloat(opt.dataset.baseprice);
      const addPrice = parseFloat(opt.dataset.addprice);
      let totalPrice = 0;
      if(qty > 0){
        totalPrice = basePrice + (qty -1) * addPrice;
      }
      priceSpan.textContent = totalPrice.toFixed(2);
    }

    plusBtn.addEventListener('click', () => {
      if(qty < stock){
        qty++;
        opt.dataset.qty = qty;
        updatePriceAndQtyDisplay();
        updateJoyConSelections();
      }
    });
    minusBtn.addEventListener('click', () => {
      if(qty > 0){
        qty--;
        opt.dataset.qty = qty;
        updatePriceAndQtyDisplay();
        updateJoyConSelections();
      }
    });

    updatePriceAndQtyDisplay();
  });

  // Met à jour le tableau joyConSelections en fonction des qty sélectionnées
  function updateJoyConSelections() {
    joyConSelections = [];
    joyConOptions.querySelectorAll('.option').forEach(opt => {
      const qty = parseInt(opt.dataset.qty);
      if(qty > 0){
        // Calcule prix total ici aussi
        const basePrice = parseFloat(opt.dataset.baseprice);
        const addPrice = parseFloat(opt.dataset.addprice);
        let totalPrice = basePrice + (qty - 1) * addPrice;
        joyConSelections.push({
          name: opt.dataset.name,
          qty: qty,
          price: totalPrice
        });
      }
    });
  }

  // Fonction pour afficher le résumé
  function updateSummary() {
    let text = '';
    let total = 0;

    if(chosenSwitch){
      text += `Switch sélectionnée : ${chosenSwitch.name} - ${chosenSwitch.price.toFixed(2)} €\n`;
      total += chosenSwitch.price;
    } else {
      text += "Switch sélectionnée : Aucune\n";
    }
    if(chosenSD){
      text += `Carte SD : ${chosenSD.name} - ${chosenSD.price.toFixed(2)} €\n`;
      total += chosenSD.price;
    } else {
      text += "Carte SD : Aucune\n";
    }

    if(joyConSelections.length > 0){
      text += `Joy-Con sélectionnés :\n`;
      joyConSelections.forEach(jc => {
        text += `  - ${jc.name} x${jc.qty} : ${jc.price.toFixed(2)} €\n`;
        total += jc.price;
      });
    } else {
      text += "Joy-Con sélectionnés : Aucun\n";
    }

    text += "\nTotal à payer : " + total.toFixed(2) + " €";
    document.getElementById('summary').textContent = text;
  }

  // Navigation entre étapes
  nextBtn.addEventListener('click', () => {
    if(currentStep === 1){
      if(!chosenSwitch){
        alert("Veuillez choisir une Switch.");
        return;
      }
      steps[1].style.display = "none";
      steps[2].style.display = "block";
      currentStep = 2;
    } else if(currentStep === 2){
      if(!chosenSD){
        alert("Veuillez choisir une carte SD.");
        return;
      }
      steps[2].style.display = "none";
      steps[3].style.display = "block";
      currentStep = 3;
    } else if(currentStep === 3){
      // Pas obligé d'avoir de Joy-Con, mais on met à jour le résumé
      updateSummary();
      steps[3].style.display = "none";
      steps[4].style.display = "block";
      nextBtn.textContent = "Recommencer";
      currentStep = 4;
    } else {
      // Recommencer
      location.reload();
    }
  });

  // Mise à jour du résumé quand on modifie les Joy-Con
  joyConOptions.addEventListener('click', () => {
    updateSummary();
  });
</script>

</body>
</html>
