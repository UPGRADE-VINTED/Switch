<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pack Switch modifi√©e</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 2rem; background: #f0f0f0; }
    .configurator { display: flex; gap: 2rem; flex-wrap: wrap; }
    .options { background: white; padding: 1rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); min-width: 320px; }
    .preview { padding: 1rem; background: white; border-radius: 10px; text-align: center; box-shadow: 0 0 10px rgba(0,0,0,0.1); flex: 1; }
    img { width: 200px; margin: 5px; }
    .total { font-size: 1.2rem; font-weight: bold; margin-top: 1rem; }
    #summary { margin-top: 2rem; padding: 1rem; background: #fff; border-radius: 10px; }
    select, button { margin-top: 5px; padding: 5px; width: 100%; font-size: 0.9rem; height: 30px; }
    label.forced-checkbox { display: flex; align-items: center; margin-top: 10px; user-select: none; cursor: default; }
    label.forced-checkbox input { margin-right: 8px; pointer-events: none; }
    .joycon-toggle { cursor: pointer; font-weight: bold; font-size: 1.1rem; margin-top: 20px; user-select: none; display: inline-block; background: #ddd; padding: 8px 12px; border-radius: 6px; transition: background-color 0.3s ease; }
    .joycon-toggle:hover { background: #ccc; }
    #joyconOptions { margin-top: 10px; display: block; border: 1px solid #ccc; border-radius: 10px; padding: 10px; background: #fafafa; }
    .joycon-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem; }
    .joycon-color { width: 20px; height: 20px; border-radius: 4px; display: inline-block; margin-right: 5px; }
    .qty-buttons button { width: 30px; height: 30px; font-size: 1.2rem; font-weight: bold; border: 1px solid #ccc; background: #fff; border-radius: 5px; margin: 0 5px; cursor: pointer; }
    .qty-display { min-width: 20px; text-align: center; font-weight: bold; font-size: 1rem; }
  </style>
</head>
<body>
<h1>üïπÔ∏è Pack Switch modifi√©e - Configurateur</h1>
<div class="configurator">
  <div class="options">
    <h3>üéÆ Console</h3>
    <select id="switchSelect" onchange="updateConfig()">
      <option value="V2 - cache SD manquant|180|switch_v2_sd">V2 - cache SD manquant (180‚Ç¨)</option>
      <option value="V2 - impeccable|190|switch_v2_ok">V2 - impeccable (190‚Ç¨)</option>
      <option value="V1 - ray√©|170|switch_v1_rayure">V1 - ray√© (170‚Ç¨)</option>
      <option value="V1 - bon √©tat|180|switch_v1_ok">V1 - bon √©tat (180‚Ç¨)</option>
      <option value="V1 - excellent|185|switch_v1_excellent">V1 - excellent (185‚Ç¨)</option>
    </select>
    <label class="forced-checkbox"><input type="checkbox" checked disabled />‚úÖ Puce HWFLY incluse (0‚Ç¨)</label>
    <h3>üíæ Carte SD</h3>
    <select id="sdSelect" onchange="updateConfig()">
      <option value="128|0|sd128">128 Go (incluse)</option>
      <option value="256|15|sd256">256 Go (+15‚Ç¨)</option>
      <option value="512|35|sd512">512 Go (+35‚Ç¨)</option>
    </select>
    <div class="joycon-toggle" onclick="toggleJoyconOptions()">üé® Joy-Con (quantit√©)</div>
    <div id="joyconOptions"></div>
    <h3>üîå Accessoires</h3>
    <label><input type="checkbox" value="10" data-img="chargeur" onchange="updateConfig()"> Chargeur secteur (10‚Ç¨)</label><br>
    <label><input type="checkbox" value="5" data-img="cable_hdmi" onchange="updateConfig()"> C√¢ble HDMI (5‚Ç¨)</label><br>
    <label><input type="checkbox" value="18" data-img="chargeur_joycon" onchange="updateConfig()"> Chargeur Joy-Con (18‚Ç¨)</label><br>
    <br><button onclick="validerCommande()">‚úÖ Valider ma commande</button>
  </div>
  <div class="preview" id="preview">
    <h3>Pr√©visualisation</h3>
    <div id="images"></div>
    <div class="total" id="total">Total : 0‚Ç¨</div>
  </div>
</div>
<div id="summary"></div>
<script>
const stockJoycon = {
  joycon_rouge_bleu: 3,
  joycon_vert_rose: 2,
  joycon_gris: 0,
  joycon_jaune: 1,
  joycon_violet: 1,
  joycon_zeldalr: 1,
  joycon_animal: 2,
  joycon_mhunter: 1,
  joycon_pokemon: 2
};

const joyconLabels = {
  joycon_rouge_bleu: 'Rouge/Bleu',
  joycon_vert_rose: 'Vert/Rose',
  joycon_gris: 'Gris',
  joycon_jaune: 'Jaune',
  joycon_violet: 'Violet',
  joycon_zeldalr: 'Zelda √©dition',
  joycon_animal: 'Animal Crossing',
  joycon_mhunter: 'Monster Hunter',
  joycon_pokemon: 'Pok√©mon √©dition'
};

const images = {
  switch_v2_sd: 'URL_IMG',
  switch_v2_ok: 'URL_IMG',
  switch_v1_rayure: 'URL_IMG',
  switch_v1_ok: 'URL_IMG',
  switch_v1_excellent: 'URL_IMG',
  sd128: 'URL_IMG',
  sd256: 'URL_IMG',
  sd512: 'URL_IMG',
  chargeur: 'URL_IMG',
  cable_hdmi: 'URL_IMG',
  chargeur_joycon: 'URL_IMG',
  joycon_rouge_bleu: 'URL_IMG',
  joycon_vert_rose: 'URL_IMG',
  joycon_gris: 'URL_IMG',
  joycon_jaune: 'URL_IMG',
  joycon_violet: 'URL_IMG',
  joycon_zeldalr: 'URL_IMG',
  joycon_animal: 'URL_IMG',
  joycon_mhunter: 'URL_IMG',
  joycon_pokemon: 'URL_IMG'
};

function toggleJoyconOptions() {
  const container = document.getElementById('joyconOptions');
  container.style.display = container.style.display === 'none' ? 'block' : 'none';
}

function updateJoyconHTML() {
  const container = document.getElementById('joyconOptions');
  container.innerHTML = '';
  for (const key in stockJoycon) {
    const stock = stockJoycon[key];
    if (stock <= 0) continue;
    const row = document.createElement('div');
    row.className = 'joycon-row';
    row.innerHTML = `
      <div>${joyconLabels[key]} (${stock} en stock)</div>
      <div class="qty-buttons">
        <button onclick="updateQty('${key}', -1)">‚àí</button>
        <span id="${key}_qty" class="qty-display">0</span>
        <button onclick="updateQty('${key}', 1)">+</button>
      </div>
    `;
    container.appendChild(row);
  }
}

function updateQty(key, delta) {
  const span = document.getElementById(`${key}_qty`);
  let qty = parseInt(span.innerText);
  qty = Math.max(0, Math.min(qty + delta, stockJoycon[key]));
  span.innerText = qty;
  updateConfig();
}

function updateConfig() {
  const imageDiv = document.getElementById('images');
  imageDiv.innerHTML = '';
  let total = 0;
  const switchOption = document.getElementById('switchSelect').value.split('|');
  const switchPrice = parseInt(switchOption[1]);
  if (!isNaN(switchPrice)) total += switchPrice;
  addImage(switchOption[2]);
  let index = 0;
  for (const key in stockJoycon) {
    const qty = parseInt(document.getElementById(`${key}_qty`)?.innerText || '0');
    for (let i = 0; i < qty; i++) {
      total += (index === 0) ? 35 : 30;
      addImage(key);
      index++;
    }
  }
  const sd = document.getElementById('sdSelect').value.split('|');
  const sdPrice = parseInt(sd[1]);
  if (!isNaN(sdPrice)) total += sdPrice;
  addImage(sd[2]);
  document.querySelectorAll('input[type=checkbox]:checked').forEach(el => {
    const val = parseInt(el.value);
    if (!isNaN(val)) total += val;
    addImage(el.getAttribute('data-img'));
  });
  document.getElementById('total').innerText = 'Total : ' + total + '‚Ç¨';
  function addImage(key) {
    const img = document.createElement('img');
    img.src = images[key];
    imageDiv.appendChild(img);
  }
}

function validerCommande() {
  const code = 'CMD-' + Math.random().toString(36).substring(2,8).toUpperCase();
  const summary = document.getElementById('summary');
  html2canvas(document.getElementById('preview')).then(canvas => {
    const imageURL = canvas.toDataURL();
    summary.innerHTML = `
      <h2>‚úÖ R√©sum√© de commande</h2>
      <p>Code de commande : <strong>${code}</strong></p>
      <img src="${imageURL}" style="width:300px; border:1px solid #ccc" /><br>
      <a href="${imageURL}" download="commande-${code}.png">üì• T√©l√©charger l'image</a>
    `;
  });
}

updateJoyconHTML();
updateConfig();
</script>
</body>
</html>
